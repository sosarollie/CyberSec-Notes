CAPA (Common Analysis Platform for Artifacts) is a tool designed to **identify the capabilities** present in executable files like Portable Executables (PE), ELF binaries, .NET modules, shellcode, and even sandbox reports. It does so by analyzing the file and applying a set of rules that **describe common behaviours**, allowing it to determine what the **program is capable of doing**, such as **network communication**, **file manipulation**, **process injection**, and many more.

- Encapsulates years of reverse engineering knowledge into an automated tool

### MITRE ATT&CK

The MITRE ATT&CK (Adversarial Tactics, Techniques, and Common Knowledge) framework is a comprehensive global knowledge repository that meticulously documents the tactics and techniques employed by threat actors at every stage of a cyber-attack. It functions as a strategic playbook, providing detailed insights into attackers' methods, from **gaining initial access** to **maintaining a presence**, **escalating privileges**, **evading defenses**, **moving laterally within a network**, and much more. 

CAPA uses this format for the output. Note that some results may or may not contain the Technique and Sub-technique Identifier.

|Format|Sample|Explanation|
|---|---|---|
|**ATT&CK Tactic**::**ATT&CK Technique**::**Technique Identifier**|Defense Evasion::Obfuscated Files or Information::T1027|**DEFENSE EVASION =** ATT&CK Tactic  <br>**Obfuscated Files or Information =** ATT&CK Technique  <br>**T1027 =** Technique Identifier|
|**ATT&CK Tactic**::**ATT&CK Technique**::**ATT&CK Sub-Technique**::**Technique Identifier**[.]Sub-technique **Identifier**|Defense Evasion::Obfuscated Files or Information::Indicator Removal from Tools T1027.005|**DEFENSE EVASION** = ATT&CK Tactic  <br>**Obfuscated Files or Information** = ATT&CK Technique  <br>**Indicator Removal from Tools** = ATT&CK Sub-Technique  <br>**T1027 =** Technique Identifier  <br>**005** = Sub-Technique Identifier|

### MAEC

**Malware Attribute Enumeration and Characterization** is a specialized language designed to encode and communicate complex details concerning malware. It contains an extensive range of attributes, including behaviours, artefacts, and interconnections among various instances of malware. This language functions as a standardized system for tracking and analyzing the complicated complexities of malware.

Malware Attribute Enumeration and Characterization

The most commonly used MAEC values by CAPA are Download and Launcher

|**MAEC Value**|Description|
|---|---|
|Launcher|Exhibits behaviours that trigger specific actions similar to malware behaviour.|
|Downloader|Exhibits behaviours wherein it downloads and executes other files, usually seen on more complex malware.|
When CAPA tags a file with a “**launcher**” MAEC value, it indicates that the file demonstrates behaviour similar to but not limited to:

- Dropping additional payloads
- Activating persistence mechanisms
- Connecting to command-and-control (C2) servers
- Executing specific functions

when CAPA tags a file with a “**Downloader**” MAEC value, it indicates that the file demonstrates behaviour similar but not limited to:

- Fetching additional payloads or resources from the internet  
- pulling in updates
- executing secondary stages
- retrieving configuration files

### Malware Behavior Catalogue (MBC)

MBC is designed to support various aspects of malware analysis, such as labelling, similarity analysis, and standardized reporting. Essentially, it serves as a catalogue of malware objectives and behaviours. MBC can also link to ATT&CK methods and log all behaviours and code features discovered during malware analysis. It's important to note that the names of MBC behaviours may or may not match the corresponding ATT&CK techniques. The information on behaviour pages complements the content on ATT&CK pages.

the content can be represented in two formats

|Format|Sample|Explanation|
|---|---|---|
|**OBJECTIVE**::**Behavior**::**Method**[**Identifier**]|ANTI-STATIC ANALYSIS::Executable Code Obfuscation::Argument Obfuscation [B0032.020]|**Anti-static Analysis** = OBJECTIVE  <br>**Executable Code Obfuscation** = BEHAVIOR  <br>**Argument Obfuscation** = METHOD  <br>**BOO32.020** = IDENTIFIER|
|**OBJECTIVE**::**Behavior**::[**Identifier**]|COMMUNICATION::HTTP Communication:: [C0002]|**COMMUNICATION** = OBJECTIVE  <br>**HTTP Communication** = BEHAVIOR  <br>**C0002** = IDENTIFIER|

[All MBC Table content](https://github.com/MBCProject/mbc-markdown/blob/main/mbc_summary.md)

---
![](../../../../../7.%20Images/Pasted%20image%2020250513180549.png)
The content of this block is represented in the below format.  

|Format|Sample|Explanation|
|---|---|---|
|**Capability(Rule Name)**::**TLN(Top-Level Namespace)**/**Namespace**|reference anti-VM strings::Anti-Analysis/anti-vm/vm-detection|**Reference anti-VM strings** = Capability(Rule Name)  <br>**Anti-Analysis** = TLN or Top-Level Namespace  <br>**anti-vm/vm-detection** = Namespace|
### Namespaces

CAPA uses namespaces to group items with the same purpose. 

| Top-Level Namespace (TLN) | Explanation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| anti-analysis             | contains a set of rules specifically designed to detect behaviours exhibited by malware to evade analysis. These behaviours include obfuscation, packing, and anti-debugging techniques.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| collection                | contains a set of data-related rules that malware may enumerate and collect for exfiltration or other purposes. Think of it as the “data-gathering” aspect of malware behaviour.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| communication             | contains a set of rules that pertain to different communication behaviours demonstrated by malware. This encompasses how malware interacts with networks, including data transmission and reception, command and control communications, and other network-related behaviours.                                                                                                                                                                                                                                                                                                                                                                                                                |
| compiler                  | contains a set of rules and configurations for recognizing specific build environments or compilers employed in generating executables. These namespaces essentially serve as the unique “signature” that identifies the compilation process of a program.                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| data-manipulation         | contains a set of rules that govern the behaviours involved in altering data within executable files. This aspect can be considered the “data transformation” component of malware behaviour, encompassing actions such as String Encryption and Data Encoding.                                                                                                                                                                                                                                                                                                                                                                                                                               |
| executable                | contains a set of rules pertaining to the attributes in executable files. These attributes include PE sections or debug info associated with the executable.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| host-interaction          | contains a set of rules related to behaviors involving interactions with the host system. This encompasses how malware interacts with its environment. Specifically, the rules in this namespace may capture behaviors related to reading, writing, or modifying files on disk, including creating, deleting, or modifying files and directories.”                                                                                                                                                                                                                                                                                                                                            |
| impact                    | contains a set of rules related to the potential consequences or effects of a program’s behavior. Think of it as the aspect that focuses on the possible harm that this malware can cause. It may include behaviors related to establishing remote access, data exfiltration, destruction, or modification.”                                                                                                                                                                                                                                                                                                                                                                                  |
| internal                  | Rules contained within the system are not intended for direct use by analysts or for reporting. Instead, these rules are meant for internal purposes within the CAPA tool, serving as the behind-the-scenes aspect of rule development and execution.                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| lib                       | building blocks to create other rules                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| linking                   | contains rules to identify behaviors involving linking or dynamically loading external code or libraries during program execution. This is its primary function and is crucial for the program’s security. Understanding linking behavior is essential for several reasons. Malware often depends on external libraries or components (such as OpenSSL, Zlib, or other third-party libraries) to carry out specific tasks. Detecting these dependencies helps analysts understand the malware’s capabilities. External libraries also introduce an additional attack surface. If a vulnerability exists in a linked library, it can be exploited by the malware or defenders during analysis. |
| load-code                 | contains a set of rules and regulations related to the behaviors associated with dynamically loading or executing code during program execution. This concept can be equated to the “runtime code injection” aspect of malware behavior, which involves unauthorized code introduction during a program’s execution.                                                                                                                                                                                                                                                                                                                                                                          |
| malware-family            | contains a set of rules related to behaviors that are linked to particular malware families or groups. It serves as a way to identify the distinct characteristics or “signatures” associated with known malware families, allowing for more accurate detection and classification of potential threats.                                                                                                                                                                                                                                                                                                                                                                                      |
| nursery                   | this is a staging ground that contains rules for those who are not quite polished                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| persistence               | contains rules related to behaviors associated with maintaining access or persistence within a compromised system. This namespace is essentially focused on understanding how malware can establish and maintain a presence within a compromised environment, allowing it to persist and carry out malicious activities over an extended period.                                                                                                                                                                                                                                                                                                                                              |
| runtime                   | contains a set of rules that seek to identify the language or platform on which the program runs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| targeting                 | contains a set of rules related to behaviors exhibited by programs that interact with ATMs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |


Let’s see how this works by checking the table below.  

| Top-Level Namespace (TLN) | Namespaces           | Rule YAML File                                                                                                  | Explanation                                                                                                                                                                                                                                                                                                                                                              |
| ------------------------- | -------------------- | --------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Anti-Analysis**         | anti-vm/vm-detection | reference-anti-vm-strings-targeting-virtualbox.yml  <br>  <br>reference-anti-vm-strings-targeting-virtualpc.yml | “anti-vm/vm-detection” namespace contains rules to detect virtual machine (VM) environments. These rules focus on identifying specific strings or patterns commonly used by malware to detect VMs while running. Using these rules, CAPA can identify if malware searches for VMware-specific registry keys, the presence of VMware tools, or other VM-related elements. |
|                           | obfuscation          | obfuscated-with-dotfuscator.yml  <br>  <br>obfuscated-with-smartassembly.yml                                    | Malware often uses obfuscation techniques to make analysis more difficult. These include methods such as String Encryption, Code Obfuscation, Packing, and Anti-Debugging Tricks. The obfuscation namespace addresses these techniques, which conceal or obscure the true purpose of the code.                                                                           |
### Capability

Below is a table with the **Capability and its related TLN, namespace, and the rules associated** with the yaml file. Please have a good look.

| Capability                                     | Top-Level Namespace (TLN)                                                                         | Namespaces            | Rule YAML file                                                            | Notes                                                                                                                                             |
| ---------------------------------------------- | ------------------------------------------------------------------------------------------------- | --------------------- | ------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| reference anti-VM strings                      | [**Anti-Analysis**](https://github.com/MBCProject/capa-rules-1/tree/master/anti-analysis)         | anti-vm/vm-detection  | reference-anti-vm-strings.yml                                             | To check all rules under this namespace, click [here](https://github.com/MBCProject/capa-rules-1/tree/master/anti-analysis/anti-vm/vm-detection)  |
| reference anti-VM strings targeting VMWare     | **Anti-Analysis**                                                                                 | anti-vm/vm-detection  | reference-anti-vm-strings-targeting-vmware.yml                            | To check all rules under this namespace, click [here](https://github.com/MBCProject/capa-rules-1/tree/master/anti-analysis/anti-forensic)         |
| reference anti-VM strings targeting VirtualBox | **Anti-Analysis**                                                                                 | anti-vm/vm-detection  | reference-anti-vm-strings-targeting-virtualbox.yml                        | You may check the TLN(Top-Level Namespace).                                                                                                       |
| reference HTTP User-Agent string               | [**Communication**](https://github.com/MBCProject/capa-rules-1/tree/master/communication)         | http/client           | reference-http-user-agent-string.yml                                      | To check all rules under this namespace, click [here](https://github.com/MBCProject/capa-rules-1/tree/master/communication/http/client))          |
| check HTTP status code                         | **Communication**                                                                                 | http                  | check-http-status-code.yml                                                | To check all rules under this namespace, click [here](https://github.com/MBCProject/capa-rules-1/tree/master/communication/http)                  |
| reference Base64 string                        | [**Data Manipulation**](https://github.com/MBCProject/capa-rules-1/tree/master/data-manipulation) | encoding/base64       | reference-base64-string.yml                                               | To check all rules under this namespace, click [here](https://github.com/MBCProject/capa-rules-1/tree/master/data-manipulation/encoding/base64)   |
| encode data using XOR                          | **Data Manipulation**                                                                             | encoding/XOR          | encode-data-using-xor.yml                                                 | To check all rules under this namespace, click [here](https://github.com/MBCProject/capa-rules-1/tree/master/data-manipulation/encoding/xor)      |
| contain a thread local storage (.tls) section  | [**Executable**](https://github.com/MBCProject/capa-rules-1/tree/master/executable)               | pe/section/tls        | contain-a-thread-local-storage-tls-section.yml                            | You may check the TLN(Top-Level Namespace) for more rules.                                                                                        |
| get common file path                           | [**Host-Interaction**](https://github.com/MBCProject/capa-rules-1/tree/master/host-interaction)   | file-system           | get-common-file-path.yml                                                  | You may check the TLN(Top-Level Namespace) for more rules.                                                                                        |
| create directory                               | **Host-Interaction**                                                                              | file-system/create    | create-directory.yml                                                      | You may check the TLN(Top-Level Namespace) for more rules.                                                                                        |
| delete file                                    | **Host-Interaction**                                                                              | file-system/delete    | delete-file.yml                                                           | To check all rules under this namespace, click [here](https://github.com/MBCProject/capa-rules-1/tree/master/host-interaction/file-system/delete) |
| read file on Windows                           | **Host-Interaction**                                                                              | file-system/read      | read-file-on-windows.yml                                                  | To check all rules under this namespace, click [here](https://github.com/MBCProject/capa-rules-1/tree/master/host-interaction/file-system/read)   |
| write file on Windows                          | **Host-Interaction**                                                                              | file-system/write     | write-file-on-windows.yml                                                 | To check all rules under this namespace, click [here](https://github.com/MBCProject/capa-rules-1/tree/master/host-interaction/file-system/write)  |
| get thread local storage value                 | **Host-Interaction**                                                                              | process               | get-thread-local-storage-value.yml                                        | This rule is found under **TLN [Nursery](https://github.com/mandiant/capa-rules/tree/master/nursery),** a staging ground for unpolished rules.    |
| allocate or change RWX memory                  | **Host-Interaction**                                                                              | process/inject        | allocate-or-change-rwx-memory.yml                                         | To check all rules under this namespace, click [here](https://github.com/MBCProject/capa-rules-1/tree/master/host-interaction/process/inject)     |
| create process on Windows                      | **Host-Interaction**                                                                              | process create        | create-process-on-windows.yml                                             | To check all rules under this namespace, click [here](https://github.com/MBCProject/capa-rules-1/tree/master/host-interaction/process/create)     |
| reference cryptocurrency strings               | [**Impact**](https://github.com/MBCProject/capa-rules-1/tree/master/impact)                       | impact/cryptocurrency | reference-cryptocurrency-strings.yml                                      | This rule is found under **TLN [Nursery](https://github.com/mandiant/capa-rules/tree/master/nursery),** a staging ground for unpolished rules.    |
| link function at runtime on Windows            | [**Linking**](https://github.com/MBCProject/capa-rules-1/tree/master/linking)                     | runtime-linking       | link-function-at-runtime-on-windows.yml                                   | To check all rules under this namespace, click [here](https://github.com/MBCProject/capa-rules-1/tree/master/linking/runtime-linking)             |
| parse PE header                                | [**load-code**](https://github.com/MBCProject/capa-rules-1/tree/master/load-code)                 | load-code/pe          | parse-pe-header.yml  <br>  <br>resolve-function-by-parsing-pe-exports.yml | To check all rules under this namespace, click [here](https://github.com/MBCProject/capa-rules-1/tree/master/load-code/pe)                        |
| resolve function by parsing PE exports         | [**load-code**](https://github.com/MBCProject/capa-rules-1/tree/master/load-code)                 | load-code/pe          | resolve-function-by-parsing-pe-exports.yml                                | To check all rules under this namespace, click [here](https://github.com/MBCProject/capa-rules-1/tree/master/load-code/pe)                        |
| run PowerShell expression                      | [**load-code**](https://github.com/MBCProject/capa-rules-1/tree/master/load-code/powershell)      | load-code/PowerShell  | run-powershell-expression.yml                                             | To check all rules under this namespace, click [here](https://github.com/MBCProject/capa-rules-1/tree/master/linking/runtime-linking)             |
| schedule task via at                           | [**persistence**](https://github.com/MBCProject/capa-rules-1/tree/master/persistence)             | scheduled-tasks       | schedule-task-via-at.yml                                                  | You may check the TLN(Top-Level Namespace) for more rules.                                                                                        |
| schedule task via schtasks                     | [**persistence**](https://github.com/MBCProject/capa-rules-1/tree/master/persistence)             | scheduled-tasks       | schedule-task-via-schtasks.yml                                            | You may check the TLN(Top-Level Namespace) for more rules.                                                                                        |

